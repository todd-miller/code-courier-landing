name: Courier

on: push

jobs:
  build:
    runs-on: ubuntu-latest    

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          persist-credentials: false
          fetch-depth: 0
         
      - name: Push to Remote
        run: |
          git config --global user.name "todd-miller"
          git config --global user.email "todd.miller@landiindustries.com"
          git remote add todd "https://${{ secrets.ACCESS_TOKEN}}@github.com/todd-miller/code-courier-landing.git"
          git remote -v
          git status -sb
          git show-ref
          git add -A 
          git rebase todd/main
          git push -f --set-upstream todd ${GITHUB_REF##*/} 

      - name: Open PR 
        uses: repo-sync/pull-request@v2 
        with:
          github_token: ${{ secrets.ACCESS_TOKEN }}
          destination_branch: "main"
          destination_repository: "todd-miller/code-courier-landing"
     
      - name: output-url
        run: echo ${{steps.open-pr.outputs.pr_url}}
      - name: output-number
        run: echo ${{steps.open-pr.outputs.pr_number}}
      - name: output-created
        run: echo ${{steps.open-pr.outputs.pr_created}}
      - name: output-has-changed-files 
        run: echo ${{steps.open-pr.outputs.has_changed_files}}
